var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,e,c){a instanceof String&&(a=String(a));for(var d=a.length,b=0;b<d;b++){var f=a[b];if(e.call(c,f,b,a))return{i:b,v:f}}return{i:-1,v:void 0}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,e,c){a!=Array.prototype&&a!=Object.prototype&&(a[e]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};
$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(a,e,c,d){if(e){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var b=a[d];b in c||(c[b]={});c=c[b]}a=a[a.length-1];d=c[a];e=e(d);e!=d&&null!=e&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:e})}};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6-impl","es3");
(function(a){function e(b){_.isUndefined(b.data.resourceHandles)||_.isUndefined(b.data.resourceType)||_.isUndefined(b.data.shop)||(a("#sbb_resource_handle").val(b.data.resourceHandles[0]),a("#sbb_resource_type").val(b.data.resourceType),a("#sbb_shop_domain").val(b.data.shop),a(".shopify-shortcode-generator").show(),a(".shopify-picker-iframe").hide())}var c=new wp.media.view.Modal({controller:{trigger:function(){}}}),d=new (wp.Backbone.View.extend({shortcode:"shopify_buy_button",template:wp.template("shopify-buybuttonwp-modal-content"),
activeEditor:null,events:{"click .js--select-shopify-product":"showProductFrame","click .js--shopify-generate-shortcode-btn":"submitShortcode"},initialize:function(){window.addEventListener("message",e,!1)},showProductFrame:function(b){b.preventDefault();a(".shopify-shortcode-generator").hide();a(".shopify-picker-iframe").show()},submitShortcode:function(a){a.preventDefault();a=this.generateShortcode();this.insertToEditor(a);this.resetForm();c.close()},generateShortcode:function(){var b="false",c=
"false";a("#sbb_has_image:checked",this.$el).length&&(b="true");if("modal"==a("#sbb_redirect_to",this.$el).val()||"collection"==a("#sbb_resource_type",this.$el).val())c="true";b={shop:a("#sbb_shop_domain",this.$el).val(),embed_type:a("#sbb_resource_type",this.$el).val(),handle:a("#sbb_resource_handle",this.$el).val(),has_image:b,has_modal:c,redirect_to:a("#sbb_redirect_to",this.$el).val()};document.getElementById("sbb_buy_button_text").value&&(b.buy_button_text=document.getElementById("sbb_buy_button_text").value);
document.getElementById("sbb_button_background_color").value&&(b.button_background_color=document.getElementById("sbb_button_background_color").value.replace("#",""));document.getElementById("sbb_button_text_color").value&&(b.button_text_color=document.getElementById("sbb_button_text_color").value.replace("#",""));document.getElementById("sbb_background_color").value&&(b.background_color=document.getElementById("sbb_background_color").value.replace("#",""));return(new wp.shortcode({tag:this.shortcode,
attrs:b,type:"single"})).string()},initJS:function(){a(".themify_sbb_ColorSelectInput",this.$el).minicolors()},insertToEditor:function(a){var b,c,d=!_.isUndefined(window.tinymce),e=!_.isUndefined(window.QTags);if(c=this.activeEditor?window.wpActiveEditor=this.activeEditor:window.wpActiveEditor)d&&(b=tinymce.get(c));else if(d&&tinymce.activeEditor)b=tinymce.activeEditor,c=window.wpActiveEditor=b.id;else if(!e)return!1;b&&!b.isHidden()?b.execCommand("mceInsertContent",!1,a):e?QTags.insertContent(a):
document.getElementById(c).value+=a},resetForm:function(){a(".shopify-shortcode-generator").hide();a(".shopify-picker-iframe").show()}}));c.on("attach",function(){var a=wp.template("shopify-buybuttonwp-modal-title");c.$el.addClass("themify_sbb_modal_container").find(".media-modal").prepend(a());c.content(d);d.initJS()});a(function(){a("body").on("click",".js--open-shopify-buy-btn",function(b){b.preventDefault();d.activeEditor=a(this).data("editor");c.open()});a(".shopify-buybuttonwp-minicolors").each(function(){a(this).minicolors({theme:"shopify-buybuttonwp",
change:function(a,c){this.val(a.replace("#",""))},hide:function(a,c){this.val(this.val().replace("#",""))}}).val(a(this).val().replace("#",""))})})})(jQuery);
